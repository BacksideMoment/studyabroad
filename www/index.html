<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="default-src * data:; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
  <script src="components/loader.js"></script>
  
  <script src="lib/LTE/plugins/jQuery/jQuery-2.1.4.min.js"></script>
  <script src="lib/LTE/bootstrap/js/bootstrap.min.js"></script>
  <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
  <script src="lib/LTE/dist/js/app.min.js"></script>
  <script src="js/fastclick.js"></script>
  
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
  
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
  <link rel="stylesheet" href="components/loader.css">
  <link rel="stylesheet" href="lib/LTE/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="lib/LTE/dist/css/AdminLTE.min.css">
  <link rel="stylesheet" href="css/style.css">
  
  <script type="text/javascript">
  // redirect('tetris');
    // 初めにログイン済かどうかチェックする
    document.addEventListener("deviceready", function(){
      FastClick.attach(document.body);
      isAuthenticated();
      }, false);
  
  
    // ログイン済みかの認証を行う
    function isAuthenticated(){
      monaca.cloud.User.autoLogin()
        .done(function(res){
          redirect('top');  
        })
        .fail(function(error){
          // jQuery
          $(function() {
            // ログインボタンが押されたら
            $("#login").click(function(){
              $("#errors").empty();
              var email = $("#email").val();
              if ( email === '' ) {
                $("#flashMessage")
                  .empty()
                  .append('<div class="alert bg-red"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><p><i class="fa fa-close"></i> メールアドレスは必ず入力してください。</p></div>');
                $("#email").focus();
                return false;
              }
              var password = $("#password").val();
              if ( password === '') {
                $("#flashMessage")
                  .empty()
                  .append('<div class="alert bg-red"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><p><i class="fa fa-close"></i> パスワードは必ず入力してください。</p></div>');
                $("#password").focus();
                return false;
                
              }
              // ログイン可能かチェック
              monaca.cloud.User.login(email, password)
                .done(function(){ // 成功なら
                  monaca.cloud.User.autoLogin()
                    .done(function(){ // ログイン成功
                      redirect('top');
                    })
                    .fail(function(error){ // ログイン失敗
                      $("#flashMessage")
                        .empty()
                        .append('<div class="alert bg-red"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><p><i class="fa fa-close"></i> ログインできません。</p></div>');
                      return false;
                    });
                })
                .fail(function(err){ // 失敗なら
                  $("#flashMessage")
                    .empty()
                    .append('<div class="alert bg-red"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><p><i class="fa fa-close"></i> ログインできません。</p></div>');
                  return false;
                });
            })
          });
        });
    }
    // 引数のhtmlにリダイレクトさせる
    function redirect(destination){
      var destination = destination;
      location.href = destination + '.html';
    }
  </script>
</head>
<body>
  <div class="row">
    <div class="col-md-12">
      <div class="box no-border">
        <div class="box-header text-center bg-navy">
          <h1><i class="fa fa-user"></i><strong> Log in</strong></h1>
        </div>
      </div>
      <div class="box-body">
        <div id="flashMessage"></div>
        <div class="form-group">
          <label class="col-md-3 control-label">Email</label>
          <div class="col-md-4">
            <input id="email" type="email" class="form-control" value=""/>
          </div>
        </div>
        
        <div class="form-group">
          <label class="col-md-3 control-label">Password</label>
          <div class="col-md-4">
            <input id="password" type="password" pattern="" class="form-control" value=""/>
          </div>
        </div>
        
      </div>
      <div id="errors"></div>
      
      <div class="box-footer">
        <div class="form-group">
          <button id="login" type="submit" class="btn btn-block bg-navy">
            <i class="fa fa-user"></i> 
            <strong>Log in</strong>
             <i class="fa fa-sign-in"></i> 
          </button>
        </div>
      </div>
    </div>
    
    <div class="col-md-12">
      <div class="box-footer">
        <div class="form-group">
          <a href="register.html" class="btn btn-block bg-red">
            <i class="fa fa-plus"></i> 
            <strong>Sign in</strong>
             <i class="fa fa-user"></i>
          </a>
        </div>
      </div>
    </div>
    
    <div class="col-md-12">
      <div class="box-footer">
        <div class="form-group">
          <a href="tetris.html" class="btn btn-block bg-aqua">
            <i class="fa fa-smile-o"></i> 
            <strong>Tetris</strong>
          </a>
        </div>
      </div>
    </div>
    
  </div>
</body>
</html>